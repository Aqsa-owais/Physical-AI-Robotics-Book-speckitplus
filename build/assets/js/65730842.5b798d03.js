"use strict";(globalThis.webpackChunkphysical_ai_robotics_book=globalThis.webpackChunkphysical_ai_robotics_book||[]).push([[476],{3588:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>_,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-1-ros/python-ros","title":"Python-based ROS 2 Development using rclpy","description":"Introduction","source":"@site/docs/module-1-ros/python-ros.md","sourceDirName":"module-1-ros","slug":"/module-1-ros/python-ros","permalink":"/giaic-hackathon-speckit-plus/docs/module-1-ros/python-ros","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros/python-ros.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Concepts: Nodes, Topics, Services, and Actions","permalink":"/giaic-hackathon-speckit-plus/docs/module-1-ros/concepts"},"next":{"title":"Communication between AI Logic and Robot Controllers","permalink":"/giaic-hackathon-speckit-plus/docs/module-1-ros/communication"}}');var s=r(4848),a=r(8453);const l={sidebar_position:4},t="Python-based ROS 2 Development using rclpy",o={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Installing rclpy",id:"installing-rclpy",level:2},{value:"Basic Node Structure",id:"basic-node-structure",level:2},{value:"Creating a Simple Node",id:"creating-a-simple-node",level:3},{value:"Working with Publishers",id:"working-with-publishers",level:2},{value:"Basic Publisher",id:"basic-publisher",level:3},{value:"Publisher with Custom Message Types",id:"publisher-with-custom-message-types",level:3},{value:"Working with Subscribers",id:"working-with-subscribers",level:2},{value:"Basic Subscriber",id:"basic-subscriber",level:3},{value:"Subscriber with Message Filters",id:"subscriber-with-message-filters",level:3},{value:"Working with Services",id:"working-with-services",level:2},{value:"Creating a Service Server",id:"creating-a-service-server",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:3},{value:"Working with Actions",id:"working-with-actions",level:2},{value:"Creating an Action Server",id:"creating-an-action-server",level:3},{value:"Creating an Action Client",id:"creating-an-action-client",level:3},{value:"Parameters",id:"parameters",level:2},{value:"Working with Parameters",id:"working-with-parameters",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Error Handling",id:"error-handling",level:3},{value:"Logging",id:"logging",level:3},{value:"Resource Management",id:"resource-management",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"python-based-ros-2-development-using-rclpy",children:"Python-based ROS 2 Development using rclpy"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"rclpy"})," package is the Python client library for ROS 2. It provides a Python API that enables Python programs to communicate with other ROS 2 nodes using the standard ROS 2 communication patterns (topics, services, actions). This guide will walk you through the fundamentals of using rclpy to create ROS 2 nodes in Python."]}),"\n",(0,s.jsx)(n.h2,{id:"installing-rclpy",children:"Installing rclpy"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"rclpy"})," package is typically installed as part of the ROS 2 distribution. If you followed the setup guide, it should already be available in your environment. You can verify the installation with:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"python3 -c \"import rclpy; print('rclpy is available')\"\n"})}),"\n",(0,s.jsx)(n.h2,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-simple-node",children:"Creating a Simple Node"}),"\n",(0,s.jsx)(n.p,{children:"Here's the basic structure of a ROS 2 node using rclpy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MinimalPublisher(Node):\n\n    def __init__(self):\n        super().__init__('minimal_publisher')\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = 'Hello World: %d' % self.i\n        self.publisher_.publish(msg)\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_publisher = MinimalPublisher()\n\n    rclpy.spin(minimal_publisher)\n\n    # Destroy the node explicitly\n    minimal_publisher.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-publishers",children:"Working with Publishers"}),"\n",(0,s.jsx)(n.h3,{id:"basic-publisher",children:"Basic Publisher"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass Talker(Node):\n\n    def __init__(self):\n        super().__init__('talker')\n        self.publisher_ = self.create_publisher(String, 'chatter', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = 'Hello World: %d' % self.i\n        self.publisher_.publish(msg)\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    talker = Talker()\n    rclpy.spin(talker)\n    talker.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"publisher-with-custom-message-types",children:"Publisher with Custom Message Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nimport numpy as np\n\nclass LaserPublisher(Node):\n\n    def __init__(self):\n        super().__init__('laser_publisher')\n        self.publisher_ = self.create_publisher(LaserScan, 'scan', 10)\n        self.timer = self.create_timer(0.1, self.publish_scan)\n\n    def publish_scan(self):\n        msg = LaserScan()\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'laser_frame'\n        msg.angle_min = -1.57  # -90 degrees in radians\n        msg.angle_max = 1.57   # 90 degrees in radians\n        msg.angle_increment = 0.01\n        msg.time_increment = 0.0\n        msg.scan_time = 0.0\n        msg.range_min = 0.0\n        msg.range_max = 10.0\n\n        # Generate some sample data\n        num_readings = int((msg.angle_max - msg.angle_min) / msg.angle_increment)\n        msg.ranges = [2.0 + 0.1 * i for i in range(num_readings)]\n\n        self.publisher_.publish(msg)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-subscribers",children:"Working with Subscribers"}),"\n",(0,s.jsx)(n.h3,{id:"basic-subscriber",children:"Basic Subscriber"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass Listener(Node):\n\n    def __init__(self):\n        super().__init__('listener')\n        self.subscription = self.create_subscription(\n            String,\n            'chatter',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    listener = Listener()\n    rclpy.spin(listener)\n    listener.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"subscriber-with-message-filters",children:"Subscriber with Message Filters"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import Image, CameraInfo\nfrom message_filters import ApproximateTimeSynchronizer, Subscriber\n\nclass ImageProcessor(Node):\n\n    def __init__(self):\n        super().__init__('image_processor')\n\n        # Create subscribers\n        self.image_sub = Subscriber(self, Image, 'image_raw')\n        self.info_sub = Subscriber(self, CameraInfo, 'camera_info')\n\n        # Synchronize the topics by time\n        ats = ApproximateTimeSynchronizer(\n            [self.image_sub, self.info_sub],\n            queue_size=5,\n            slop=0.1\n        )\n        ats.registerCallback(self.sync_callback)\n\n    def sync_callback(self, image, camera_info):\n        self.get_logger().info(f'Got synchronized image and camera info')\n        # Process the synchronized data\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-services",children:"Working with Services"}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalService(Node):\n\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_service = MinimalService()\n    rclpy.spin(minimal_service)\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalClientAsync(Node):\n\n    def __init__(self):\n        super().__init__('minimal_client_async')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_client = MinimalClientAsync()\n    response = minimal_client.send_request(1, 2)\n    minimal_client.get_logger().info(\n        'Result of add_two_ints: for %d + %d = %d' %\n        (1, 2, response.sum))\n    minimal_client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-actions",children:"Working with Actions"}),"\n",(0,s.jsx)(n.h3,{id:"creating-an-action-server",children:"Creating an Action Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom rclpy.qos import QoSProfile\n\nfrom action_tutorials_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback)\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            # Check if there is a cancel request\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\n\n            self.get_logger().info('Publishing feedback: {0}'.format(feedback_msg.sequence))\n\n            # Publish feedback\n            goal_handle.publish_feedback(feedback_msg)\n\n            # Sleep to simulate work\n            time.sleep(1)\n\n        goal_handle.succeed()\n\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        self.get_logger().info('Returning result: {0}'.format(result.sequence))\n\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    fibonacci_action_server = FibonacciActionServer()\n    rclpy.spin(fibonacci_action_server)\n    fibonacci_action_server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"creating-an-action-client",children:"Creating an Action Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\n\nfrom action_tutorials_interfaces.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            'fibonacci')\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self._action_client.wait_for_server()\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info('Received feedback: {0}'.format(feedback.sequence))\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info('Result: {0}'.format(result.sequence))\n        rclpy.shutdown()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_client = FibonacciActionClient()\n    action_client.send_goal(10)\n    rclpy.spin(action_client)\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsx)(n.h3,{id:"working-with-parameters",children:"Working with Parameters"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass ParameterNode(Node):\n\n    def __init__(self):\n        super().__init__('parameter_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('my_parameter', 'default_value')\n        self.declare_parameter('integer_param', 42)\n        self.declare_parameter('double_param', 3.14)\n        self.declare_parameter('bool_param', True)\n\n        # Get parameter values\n        my_param = self.get_parameter('my_parameter').value\n        int_param = self.get_parameter('integer_param').value\n\n        self.get_logger().info(f'My parameter: {my_param}')\n        self.get_logger().info(f'Integer parameter: {int_param}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ParameterNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.exceptions import ParameterNotDeclaredException\n\nclass RobustNode(Node):\n\n    def __init__(self):\n        super().__init__('robust_node')\n\n        try:\n            self.declare_parameter('config_param', 'default')\n            config_value = self.get_parameter('config_param').value\n        except ParameterNotDeclaredException:\n            self.get_logger().error('Parameter not declared')\n            config_value = 'default'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass LoggingNode(Node):\n\n    def __init__(self):\n        super().__init__('logging_node')\n\n        # Different log levels\n        self.get_logger().debug('Debug message')\n        self.get_logger().info('Info message')\n        self.get_logger().warn('Warning message')\n        self.get_logger().error('Error message')\n        self.get_logger().fatal('Fatal message')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"resource-management",children:"Resource Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass ResourceNode(Node):\n\n    def __init__(self):\n        super().__init__('resource_node')\n\n        # Create timers, publishers, subscribers\n        self.timer = self.create_timer(1.0, self.timer_callback)\n        self.pub = self.create_publisher(String, 'topic', 10)\n\n    def destroy_node(self):\n        # Clean up resources before destroying the node\n        self.timer.cancel()\n        super().destroy_node()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"The rclpy library provides a comprehensive Python interface to ROS 2 functionality. By understanding how to create nodes, publishers, subscribers, services, and actions using rclpy, you can build sophisticated robotic applications in Python. The examples provided here cover the most common use cases, but rclpy supports many additional features including parameter handling, logging, and quality of service settings that you can explore as needed for your specific applications."})]})}function _(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>t});var i=r(6540);const s={},a=i.createContext(s);function l(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);